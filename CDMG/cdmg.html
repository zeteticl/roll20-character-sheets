<div class="collateral-damage">
    <!--Logo / Player Name / Movie Title -->
    <div class="2colrow">
        <div class="col">
            <img src="https://github.com/patschroed/roll20-character-sheets/blob/master/CDMG/cdmg-logo.png?raw=true" />
        </div>
        <div class="col">
            <div>
                <input type="text" name="attr_name" />
                <div class="input-label-header">PLAYER NAME</div>
            </div>
            <div>
                <input type="text" name="attr_movie_title" />
                <div class="input-label-header">MOVIE TITLE</div>
            </div>
        </div>
    </div>

    <!--Act summaries-->
    <div class="3colrow row-padding">
        <div class="col">
            <div class="section-act-heading">Act 1 <br> Objectives</div>
            <textarea name="attr_act_1_objective"></textarea>
        </div>
        <div class="col">
            <div class="section-act-heading">Act 2 <br> Objectives</div>
            <textarea name="attr_act_2_objective"></textarea>
        </div>
        <div class="col">
            <div class="section-act-heading">Act 3 <br> Objectives</div>
            <textarea name="attr_act_3_objective"></textarea>
        </div>
    </div>

    <!--Player Info / Stats / Wounds / Relationships -->
    <div class="2colrow row-padding">
        <div class="col">
            <div class="section-heading">
                PLAYER INFO
            </div>
            <div class="section-content">
                <input type="text" name="attr_character_name" />
                <div class="input-label">CHARACTER NAME</div>
                <input type="text" name="attr_class" />
                <div class="input-label">CLASS</div>
                <input type="text" name="attr_mentality" />
                <div class="input-label">MENTALITY</div>
                <input type="text" name="attr_flaw" />
                <div class="input-label">FLAW</div>
            </div>

            <div class="section-heading">
                STATS
            </div>
            <div class="section-content">
                <div>
                    <div class="stat-content">
                        LUCK:
                    </div>
                    <div class="stat-content">
                        <input class="center-text" type="text" name="attr_luck_base" />
                        <div class="input-label center-text">BASE</div>
                    </div>
                    <div class="stat-content">
                        <label>
                            <input name="attr_luck_modifier" type="checkbox" value="1"/>
                            <span></span>
                        </label>
                    </div>
                    <div class="stat-content">
                        <input class="center-text" type="text" name="attr_luck_bonus" />
                        <div class="input-label center-text">BONUS</div>
                    </div>
                    <div class="stat-content"> = </div>
                    <div class="stat-content">
                        <input type="hidden" name="attr_luck_total_hidden" />
                        <input class="center-text" type="text" name="attr_luck_total" value="@{luck_total_hidden}" disabled/>
                        <div class="input-label center-text">TOTAL</div>
                    </div>
                    <div class="stat-content">
                        <input type="hidden" name="attr_luck_dice_hidden" />
                        <input class="center-text" type="text" name="attr_luck_dice" value="@{luck_dice_hidden}" disabled/>
                      <div class="input-label center-text">d6</div>
                    </div>
                    <div class="stat-content">
                        <button class="stat-roll" type="roll" value="/roll @{luck_dice}d6" name="roll_luck_check"></button>
                    </div>

                </div>
                <div>
                    <div class="stat-content">
                        VUL:
                    </div>
                    <div class="stat-content">
                        <input class="center-text" type="text" name="attr_vul_base" />
                        <div class="input-label center-text">BASE</div>
                    </div>
                    <div class="stat-content">
                        <label>
                            <input name="attr_vul_modifier" type="checkbox" value="1"/>
                            <span></span>
                        </label>
                    </div>
                    <div class="stat-content">
                        <input class="center-text" type="text" name="attr_vul_bonus" />
                        <div class="input-label center-text">BONUS</div>
                    </div>
                    <div class="stat-content"> = </div>
                    <div class="stat-content">
                        <input type="hidden" name="attr_vul_total_hidden" />
                        <input class="center-text" type="text" name="attr_vul_total" value="@{vul_total_hidden}" disabled/>
                        <div class="input-label center-text">TOTAL</div>
                    </div>
                    <div class="stat-content">
                        <input type="hidden" name="attr_vul_dice_hidden" />
                        <input class="center-text" type="text" name="attr_vul_dice"  value="@{vul_dice_hidden}" disabled/>
                        <div class="input-label center-text">d6</div>
                    </div>
                    <div class="stat-content">
                        <button class="stat-roll" type="roll" value="/roll @{vul_dice}d6" name="roll_vul_check"></button>
                    </div>
                </div>
                <div>
                    <div class="stat-content">
                        RES:
                    </div>
                    <div class="stat-content">
                        <input class="center-text" type="text" name="attr_res_base" />
                        <div class="input-label center-text">BASE</div>
                    </div>
                    <div class="stat-content">
                        <label>
                            <input name="attr_res_modifier" type="checkbox" value="1"/>
                            <span></span>
                        </label>
                    </div>
                    <div class="stat-content">
                        <input class="center-text" type="text" name="attr_res_bonus" />
                        <div class="input-label center-text">BONUS</div>
                    </div>
                    <div class="stat-content"> = </div>
                    <div class="stat-content">
                        <input type="hidden" name="attr_res_total_hidden" />
                        <input class="center-text" type="text" name="attr_res_total" value="@{res_total_hidden}" disabled/>
                        <div class="input-label center-text">TOTAL</div>
                    </div>
                    <div class="stat-content">
                        <input type="hidden" name="attr_res_dice_hidden" />
                        <input class="center-text" type="text" name="attr_res_dice"  value="@{res_dice_hidden}" disabled/>
                        <div class="input-label center-text">d6</div>
                    </div>
                    <div class="stat-content">
                        <button class="stat-roll" type="roll" value="/roll @{res_dice}d6" name="roll_res_check"></button>
                    </div>
                </div>
            </div>
            <div class="section-content">
                <div class="stats-dice-header">
                    STAT TOTAL DICE CHART
                </div>
                <table>
                    <tr>
                        <td>1 - 4</td>
                        <td>1d6</td>
                    </tr>
                    <tr>
                        <td>5 - 8</td>
                        <td>2d6</td>
                    </tr>
                    <tr>
                        <td>9+</td>
                        <td>3d6</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="col">
            <div class="section-heading">
                WOUNDS
            </div>
            <div class="section-content">
                <ul>
                    <li>
                        <label>
                            <input name="attr_wound_1" type="checkbox" />
                            <span></span>
                        </label>
                    </li>
                    <li>
                        <label>
                            <input name="attr_wound_2" type="checkbox" />
                            <span></span>
                        </label>
                    </li>
                    <li>
                        <label>
                            <input name="attr_wound_3" type="checkbox" />
                            <span></span>
                        </label>
                    </li>
                    <li>
                        <label>
                            <input name="attr_wound_4" type="checkbox" />
                            <span></span>
                        </label>
                    </li>
                    <li>
                        <label>
                            <input name="attr_wound_5" type="checkbox" />
                            <span></span>
                        </label>
                    </li>
                </ul>
            </div>

            <div>
                <div class="section-heading">
                    RELATIONSHIPS
                </div>
                <div>
                    <div class="section-content">
                        <div>
                            LEFT:
                        </div>
                        <div>
                            <label>YOUR ROLL:</label>
                            <textarea name="attr_left_your"></textarea>
                            <label>THEIR ROLL:</label>
                            <textarea name="attr_left_their"></textarea>
                        </div>
                    </div>
                    <div class="section-content">
                        <div>
                            RIGHT:
                        </div>
                        <div>
                            <label>YOUR ROLL:</label>
                            <textarea name="attr_right_your"></textarea>
                            <label>THEIR ROLL:</label>
                            <textarea name="attr_right_their"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sheetworker scripts -->
<script type="text/worker">
const stats = ["luck", "vul", "res"];
stats.forEach(stat => {
    on(`change:${stat}_base change:${stat}_modifier change:${stat}_bonus`, () => {
        getAttrs([`${stat}_base`, `${stat}_modifier`, `${stat}_bonus`], values => {
            const base = parseInt(values[`${stat}_base`]) || 0;
            const mod = parseInt(values[`${stat}_modifier`]) || 0;
            const bonus = parseInt(values[`${stat}_bonus`]) || 0;

            //Calculate the total
            let total;
            if(mod) total = base - bonus;
            else total = base + bonus;

            //Calculate the dice bonus
            let dice;
            if(total < 5) dice = 1;
            else if(total >= 5 && total < 9) dice = 2;
            else dice = 3;

            setAttrs({
                [`${stat}_total_hidden`]: total,
                [`${stat}_dice_hidden`]: dice
            });
        });
    });
});
</script>
