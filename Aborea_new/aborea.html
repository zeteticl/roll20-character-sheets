<div class="sheet-container">
    <div class="sheet-main">
        <div class="sheet-float sheet-half">
            <div class="sheet-row">
                <label class="sheet-redbg">Charaktername</label><input type="text" id="attr_character_name"
                    name="attr_character_name" />
            </div>
            <div class="sheet-row">
                <div class="sheet-ep">
                    <label>EP</label><input type="number" name="attr_ep" />
                    <label>Stufe</label><input type="number" name="attr_stufe" readOnly />
                    <label>AP</label><input type="number" name="attr_AP" />
                </div>
                <div class="sheet-vermoegen">
                    <label>GF</label><input type="number" name="attr_gf" />
                    <label>TT</label><input type="number" name="attr_tt" />
                    <label>KL</label><input type="number" name="attr_kl" />
                    <label>MU</label><input type="number" name="attr_mu" />
                </div>
            </div>
            <div class="sheet-row">
                <div class="sheet-stats">
                    <div>
                    <label>Leben</label>
                        <input type="number" name="attr_leben" placeholder="Aktuell" /> / <input type="number"
                            name="attr_leben_max" />
                    </div>
                    <div>
                        <label class="moreleft">Rüstung</label><input type="number" name="attr_ruestung" />
                    </div>
                    <div>
                        <label>&larr; Modifier</label><input type="number" name="attr_ruestung_modifier" value="0" />
                    </div>
                    <div>
                        <label>Gl. Modifier</label><input type="number" name="attr_global_modifier" value="0" />
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-float sheet-half">
            <div class="sheet-row">
                <label class="sheet-redbg">Spieler-Name</label><input type="text" name="attr_SpielerName" />
            </div>
            <div class="sheet-row sheet-twice">
                <div><label class="sheet-redbg">Volk</label><input type="text" name="attr_Volk" />
                </div>
                <div class="sheet-beruf">
                    <label class="sheet-switch">
                        <input type="checkbox" name="attr_toggle_beruf" value="1" checked />
                        <span class="sheet-slider"></span>
                    </label>
                    <label class="sheet-redbg">Beruf</label>
                    <input type="checkbox" name="attr_toggle_beruf" value="1" style="display: none;" checked />
                    <input type="text" name="attr_beruf" />
                    <select name="attr_beruf">
                        <option value="Barde">Barde</option>
                        <option value="Dieb">Dieb</option>
                        <option value="Krieger">Krieger</option>
                        <option value="Priester">Priester</option>
                        <option value="Schamane">Schamane</option>
                        <option value="Waldläufer">Waldläufer</option>
                        <option value="Zauberer">Zauberer</option>
                    </select>
                </div>
            </div>
            <div class="sheet-row sheet-settings">
                <div>
                    <select name="attr_gmroll">
                        <option value="0" selected disabled>Auswahl treffen</option>
                        <option value="nogm">Für alle sichtbar würfeln</option>
                        <option value="gm">Für GM würfeln</option>
                    </select>
                    <input type="hidden" name="attr_abilityroll" />
                </div>
                <div>
                    <label class="sheet-switch">
                        <input type="checkbox" name="attr_calcleben" value="1" checked />
                        <span class="sheet-slider"></span>
                    </label>
                    Lebensberechnung
                </div>
                <div>
                    <label class="sheet-switch">
                        <input type="checkbox" name="attr_calcmoney" value="1" checked />
                        <span class="sheet-slider"></span>
                    </label>
                    Geldberechnung
                </div>
                <div>
                    <label class="sheet-switch">
                        <input type="checkbox" name="attr_calcmana" value="1" checked />
                        <span class="sheet-slider"></span>
                    </label>
                    Manaberechnung
                </div>
            </div>
        </div>

        <div class="sheet-clear"></div>

        <div class="sheet-grid">
        </div>
        <div class="sheet-float sheet-half sheet-attribut">
            <div class="sheet-grid">
                <div>Attribut</div>
                <div>Wert</div>
                <div>Mod</div>
                <div style="background-color: transparent;"></div>
                <div>Bonus</div>
                <div>Roll</div>
            </div>
            <div class="sheet-gridplace">

                <div class="repcontainer">
                    <div class="repitem">
                        <div class="sheet-name"><strong>St</strong>ärke</div>
                        <input type="number" name="attr_st" />
                        <input type="number" name="attr_st_bonus" value="0" />
                        <div class="sheet-arrow"></div>
                        <input type="number" name="attr_stb" readOnly />
                        <button type="roll" name="roll_st"
                            value="@{abilityroll} versucht sich in Stärke [[1d10! + @{stb} + @{ruestung_modifier} + @{global_modifier} + ?{Modifier?|0}]]"></button>

                        <div class="sheet-name"><strong>Ge</strong>schicklichkeit</div>
                        <input type="number" name="attr_ge" />
                        <input type="number" name="attr_ge_bonus" value="0" />
                        <div class="sheet-arrow"></div>
                        <input type="number" name="attr_geb" readOnly />
                        <button type="roll" name="roll_ge"
                            value="@{abilityroll} versucht sich in Geschicklichkeit [[1d10! + @{geb} + @{ruestung_modifier} + @{global_modifier} + ?{Modifier?|0}]]"></button>

                        <div class="sheet-name"><strong>Ko</strong>nstitution</div>
                        <input type="number" name="attr_ko" />
                        <input type="number" name="attr_ko_bonus" value="0" />
                        <div class="sheet-arrow"></div>
                        <input type="number" name="attr_kob" readOnly />
                        <button type="roll" name="roll_ko"
                            value="@{abilityroll} versucht sich in Konstitution [[1d10! + @{kob} + @{ruestung_modifier} + @{global_modifier} + ?{Modifier?|0}]]"></button>

                        <div class="sheet-name"><strong>In</strong>telligenz</div>
                        <input type="number" name="attr_in" />
                        <input type="number" name="attr_in_bonus" value="0" />
                        <div class="sheet-arrow"></div>
                        <input type="number" name="attr_inb" readOnly />
                        <button type="roll" name="roll_in"
                            value="@{abilityroll} versucht sich in Intelligenz [[1d10! + @{inb} + @{global_modifier} + ?{Modifier?|0}]]"></button>

                        <div class="sheet-name"><strong>Ch</strong>arisma</div>
                        <input type="number" name="attr_ch" />
                        <input type="number" name="attr_ch_bonus" value="0" />
                        <div class="sheet-arrow"></div>
                        <input type="number" name="attr_chb" readOnly />
                        <button type="roll" name="roll_ch"
                            value="@{abilityroll} versucht sich in Charisma [[1d10! + @{chb} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-float sheet-half">
            <div class="sheet-row sheet-small">
                <div class="sheet-gott">
                    <div>Göttliche Chance / Punkte</div>
                    <input type="checkbox" name="attr_1" />
                    <input type="checkbox" name="attr_2" />
                    <input type="checkbox" name="attr_3" />
                    <input type="checkbox" name="attr_4" />
                    <input type="checkbox" name="attr_5" />
                </div>
                <div class="sheet-mana">
                    <label>Mana</label>
                    <div>
                        <input type="number" name="attr_mana" placeholder="Aktuell" /> / <input type="number"
                            name="attr_mana_max" />
                    </div>
                </div>
            </div>

            <div class="sheet-row sheet-small sheet-magie">
                <div class="sheet-grid">
                    <div>Magie</div>
                    <div>Attr.</div>
                    <div>Wert</div>
                    <div>Mod</div>
                    <div>Roll</div>
                </div>
                <div class="sheet-gridplace">
                    <div class="repcontainer">
                        <div class="repitem">
                            <div>Magie entwickeln</div>
                            <div>
                                <select name="attr_mag_attribut">
                                    <option value="@{inb}" selected>IN</option>
                                    <option value="@{chb}">CH</option>
                                </select>
                            </div>
                            <div><input type="number" name="attr_mag" value="0" /></div>
                            <div></div>
                            <div></div>
                        </div>
                        <div class="repitem">
                            <div>Gezielte Sprüche</div>
                            <div>
                                <select name="attr_gezsp_attribut">
                                    <option value="@{inb}" selected>IN</option>
                                    <option value="@{chb}">CH</option>
                                </select>
                            </div>
                            <div><input type="number" name="attr_gezsp" value="0" /></div>
                            <div><input type="number" name="attr_gezsp_bonus" value="0" /></div>
                            <div><button type="roll" name="roll_gezsp"
                                    value="@{abilityroll} wirkt einen geziehlten Zauber mit dem Ergebnis [[1d10! + @{gezsp_attribut} + @{gezsp} + @{gezsp_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sheet-clear"></div>

        <div class="sheet-float sheet-half sheet-fertigkeiten">
            <div class="sheet-grid">
                <div>Fertigkeit</div>
                <div>Attr.</div>
                <div>Wert</div>
                <div>Mod</div>
                <div>Roll</div>
            </div>
            <div class="sheet-gridplace">

                <div class="repcontainer">
                    <div class="repitem">
                        <div>Athletik</div>
                        <div>
                            <select name="attr_athletik_attribut">
                                <option value="@{stb} + @{ruestung_modifier}">ST</option>
                                <option value="@{geb} + @{ruestung_modifier}" selected>GE</option>
                                <option value="@{kob} + @{ruestung_modifier}">KO</option>
                                <option value="@{inb}">IN</option>
                                <option value="@{chb}">CH</option>
                            </select>
                        </div>
                        <div><input type="number" name="attr_athletik" value="0" /></div>
                        <div><input type="number" name="attr_athletik_bonus" value="0" /></div>
                        <div><button type="roll" name="roll_athletik"
                                value="@{abilityroll} würfelt Athletik mit dem Ergebnis [[1d10! + @{athletik_attribut} + @{athletik} + @{athletik_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                        </div>
                    </div>
                    <div class="repitem">
                        <div>Einflussnahme</div>
                        <div>
                            <select name="attr_einflussnahme_attribut">
                                <option value="@{stb} + @{ruestung_modifier}">ST</option>
                                <option value="@{geb} + @{ruestung_modifier}">GE</option>
                                <option value="@{kob} + @{ruestung_modifier}">KO</option>
                                <option value="@{inb}">IN</option>
                                <option value="@{chb}" selected>CH</option>
                            </select>
                        </div>
                        <div><input type="number" name="attr_einflussnahme" value="0" /></div>
                        <div><input type="number" name="attr_einflussnahme_bonus" value="0" /></div>
                        <div><button type="roll" name="roll_einflussnahme"
                                value="@{abilityroll} würfelt Einflussnahme mit dem Ergebnis [[1d10! + @{einflussnahme_attribut} + @{einflussnahme} + @{einflussnahme_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                        </div>
                    </div>
                    <div class="repitem">
                        <div>List</div>
                        <div>
                            <select name="attr_list_attribut">
                                <option value="@{stb} + @{ruestung_modifier}">ST</option>
                                <option value="@{geb} + @{ruestung_modifier}" selected>GE</option>
                                <option value="@{kob} + @{ruestung_modifier}">KO</option>
                                <option value="@{inb}">IN</option>
                                <option value="@{chb}">CH</option>
                            </select>
                        </div>
                        <div><input type="number" name="attr_list" value="0" /></div>
                        <div><input type="number" name="attr_list_bonus" value="0" /></div>
                        <div><button type="roll" name="roll_list"
                                value="@{abilityroll} würfelt List mit dem Ergebnis [[1d10! + @{list_attribut} + @{list} + @{list_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                        </div>
                    </div>
                    <div class="repitem">
                        <div>Natur</div>
                        <div>
                            <select name="attr_natur_attribut">
                                <option value="@{stb} + @{ruestung_modifier}">ST</option>
                                <option value="@{geb} + @{ruestung_modifier}" selected>GE</option>
                                <option value="@{kob} + @{ruestung_modifier}">KO</option>
                                <option value="@{inb}">IN</option>
                                <option value="@{chb}">CH</option>
                            </select>
                        </div>
                        <div><input type="number" name="attr_natur" value="0" /></div>
                        <div><input type="number" name="attr_natur_bonus" value="0" /></div>
                        <div><button type="roll" name="roll_natur"
                                value="@{abilityroll} würfelt Natur mit dem Ergebnis [[1d10! + @{natur_attribut} + @{natur} + @{natur_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                        </div>
                    </div>
                    <div class="repitem">
                        <div>Reiten</div>
                        <div>
                            <select name="attr_reiten_attribut">
                                <option value="@{stb} + @{ruestung_modifier}">ST</option>
                                <option value="@{geb} + @{ruestung_modifier}" selected>GE</option>
                                <option value="@{kob} + @{ruestung_modifier}">KO</option>
                                <option value="@{inb}">IN</option>
                                <option value="@{chb}">CH</option>
                            </select>
                        </div>
                        <div><input type="number" name="attr_reiten" value="0" /></div>
                        <div><input type="number" name="attr_reiten_bonus" value="0" /></div>
                        <div><button type="roll" name="roll_reiten"
                                value="@{abilityroll} würfelt Reiten mit dem Ergebnis [[1d10! + @{reiten_attribut} + @{reiten} + @{reiten_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                        </div>
                    </div>
                    <div class="repitem">
                        <div>Schwimmen</div>
                        <div>
                            <select name="attr_schwimmen_attribut">
                                <option value="@{stb} + @{ruestung_modifier}">ST</option>
                                <option value="@{geb} + @{ruestung_modifier}" selected>GE</option>
                                <option value="@{kob} + @{ruestung_modifier}">KO</option>
                                <option value="@{inb}">IN</option>
                                <option value="@{chb}">CH</option>
                            </select>
                        </div>
                        <div><input type="number" name="attr_schwimmen" value="0" /></div>
                        <div><input type="number" name="attr_schwimmen_bonus" value="0" /></div>
                        <div><button type="roll" name="roll_schwimmen"
                                value="@{abilityroll} würfelt Schwimmen mit dem Ergebnis [[1d10! + @{schwimmen_attribut} + @{schwimmen} + @{schwimmen_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                        </div>
                    </div>
                    <div class="repitem">
                        <div>Wahrnehmung</div>
                        <div>
                            <select name="attr_wa_attribut">
                                <option value="@{stb} + @{ruestung_modifier}">ST</option>
                                <option value="@{geb} + @{ruestung_modifier}">GE</option>
                                <option value="@{kob} + @{ruestung_modifier}">KO</option>
                                <option value="@{inb}" selected>IN</option>
                                <option value="@{chb}">CH</option>
                            </select>
                        </div>
                        <div><input type="number" name="attr_wa" value="0" /></div>
                        <div><input type="number" name="attr_wa_bonus" value="0" /></div>
                        <div><button type="roll" name="roll_wa"
                                value="@{abilityroll} würfelt Wahrnehmung mit dem Ergebnis [[1d10! + @{wa_attribut} + @{wa} + @{wa_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="sheet-float sheet-half sheet-fertigkeiten">
            <div class="sheet-grid">
                <div>Fertigkeit</div>
                <div>Attr.</div>
                <div>Wert</div>
                <div>Mod</div>
                <div>Roll</div>
            </div>
            <div class="sheet-gridplace">
                <fieldset class="repeating_fertigkeiten">
                    <div><input class="sheet-textcenter" type="text" name="attr_fertigkeit_name" /></div>
                    <div>
                        <select name="attr_fertigkeit_attribut">
                            <option value="@{stb} + @{ruestung_modifier}">ST</option>
                            <option value="@{geb} + @{ruestung_modifier}">GE</option>
                            <option value="@{kob} + @{ruestung_modifier}">KO</option>
                            <option value="@{inb}">IN</option>
                            <option value="@{chb}">CH</option>
                        </select>
                    </div>
                    <div><input type="number" name="attr_fertigkeit_value" value="0" /></div>
                    <div><input type="number" name="attr_fertigkeit_bonus" value="0" /></div>
                    <div><button type="roll" name="roll_skill"
                            value="@{abilityroll} würfelt @{fertigkeit_name} mit dem Ergebnis [[1d10! +@{fertigkeit_attribut} + @{fertigkeit_value} + @{fertigkeit_bonus} + @{global_modifier} + ?{Modifier?|0}]]"></button>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="sheet-clear"></div>

        <div class="sheet-float sheet-kampf">
            <div class="sheet-grid">
                <div>Waffe</div>
                <div>Attribut</div>
                <div>Fertigkeit</div>
                <div>KB</div>
                <div>Schaden</div>
                <div>Ini-Bonus</div>
                <div>Init.</div>
                <div>Angr.</div>
            </div>
            <div class="sheet-gridplace">
                <fieldset class="repeating_waffen">
                    <div><input class="sheet-textcenter" type="text" name="attr_kampf_waffenname"
                            placeholder="Kurzschwert" /></div>
                    <select name="attr_kampf_attribut">
                        <option value="@{stb} + @{ruestung_modifier}">ST</option>
                        <option value="@{geb} + @{ruestung_modifier}">GE</option>
                    </select>
                    <div><input class="sheet-textcenter" type="text" name="attr_kampf_fertigkeit"
                            placeholder="Kurze Klingenwaffe" /></div>
                    <div><input type="number" name="attr_kampf_kb" value="0" /></div>
                    <div><input type="number" name="attr_kampf_schaden" value="0" /></div>
                    <div><input type="number" name="attr_kampf_inib" value="0" /></div>
                    <div><button type="roll" name="roll_kampf_init"
                            value="@{abilityroll} nutzt @{kampf_waffenname} mit einer Initiative von [[@{geb} + @{kampf_inib} &{tracker}]]"></button>
                    </div>
                    <div><button type="roll" name="roll_kampf_angr"
                            value="@{abilityroll} greift mit @{kampf_waffenname} an würfelt eine [[1d10!+ ?{Offensivbonus?|@{kampf_kb}} + @{global_modifier} + ?{Kampf-Modifier?|0}]] mit [[@{kampf_schaden} + ?{Schaden-Modifier?|0}]] Schaden. Der DB beträgt [[floor(@{kampf_KB}-?{Offensivbonus?})]]"></button>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="sheet-clear"></div>

        <div class="sheet-float sheet-half sheet-inventar">
            <div class="sheet-redbg">Inventar</div>
            <fieldset class="repeating_inventar">
                <div class="sheet-options sheet-inventar-row">
                    <input class="sheet-options-flag" name="attr_options-flag" type="checkbox"
                        title="Show/hide options"><span>y</span>
                    <input type="text" name="attr_name" placeholder="Gegenstand/Rüstung" />
                    <input type="text" name="attr_wight" placeholder="Info/Rüstwert" />
                    <input type="number" name="attr_costs" placeholder="Anzahl" />
                    <textarea name="attr_description" placeholder="Beschreibung"></textarea>
                </div>
            </fieldset>
        </div>

        <div class="sheet-float sheet-half sheet-notes">
            <div class="sheet-redbg">Notizen</div>
            <fieldset class="repeating_notes">
                <div class="sheet-options sheet-notes-row">
                    <input class="sheet-options-flag" name="attr_options-flag" type="checkbox"
                        title="Show/hide options"><span>y</span>
                    <input type="text" name="attr_title" placeholder="Titel" />
                    <textarea name="attr_body" placeholder="Inhalt"></textarea>
                </div>

            </fieldset>
        </div>

    </div>
</div>

<!-- worker scripts -->
<script type="text/worker">
    on("change:gmroll", function(f) {
        getAttrs(["gmroll"], function(v) {
            let rollstring = "/me";
            if (v.gmroll == "nogm")  {
                rollstring = "/me";
            } else if (v.gmroll == "gm") {
                rollstring = "/w GM **@{character_name}**";
            }
            setAttrs({
                abilityroll: rollstring
            });
        });
    });

    on("change:st change:st_bonus", function() {
        getAttrs(["st", "st_bonus"], function(values) {
            let st = parseInt(values.st) + parseInt(values.st_bonus) || 0;
            if (st == 1) {
                setAttrs({ stb: -3 });
            }
            if (st == 2) {
                setAttrs({ stb: -2 });
            }
            if (st == 3 || st == 4) {
                setAttrs({ stb: -1 });
            }
            if (st == 5) {
                setAttrs({ stb: 0 });
            }
            if (st == 6 || st == 7) {
                setAttrs({ stb: 1 });
            }
            if (st == 8 || st == 9) {
                setAttrs({ stb: 2 });
            }
            if (st == 10 || st == 11) {
                setAttrs({ stb: 3 });
            }
            if (st == 12 || st == 13) {
                setAttrs({ stb: 4 });
            }
            if (st >= 14) {
                setAttrs({ stb: 5 });
            }
        });
    });

    on("change:ge change:ge_bonus", function() {
        getAttrs(["ge", "ge_bonus"], function(values) {
            let ge = parseInt(values.ge) + parseInt(values.ge_bonus) || 0;
            if (ge == 1) {
                setAttrs({ geb: -3 });
            }
            if (ge == 2) {
                setAttrs({ geb: -2 });
            }
            if (ge == 3 || ge == 4) {
                setAttrs({ geb: -1 });
            }
            if (ge == 5) {
                setAttrs({ geb: 0 });
            }
            if (ge == 6 || ge == 7) {
                setAttrs({ geb: 1 });
            }
            if (ge == 8 || ge == 9) {
                setAttrs({ geb: 2 });
            }
            if (ge == 10 || ge == 11) {
                setAttrs({ geb: 3 });
            }
            if (ge == 12 || ge == 13) {
                setAttrs({ geb: 4 });
            }
            if (ge >= 14) {
                setAttrs({ geb: 5 });
            }
        });
    });

    on("change:ko change:ko_bonus", function() {
        getAttrs(["ko", "ko_bonus"], function(values) {
            let ko = parseInt(values.ko) + parseInt(values.ko_bonus) || 0;
            if (ko == 1) {
                setAttrs({ kob: -3 });
            }
            if (ko == 2) {
                setAttrs({ kob: -2 });
            }
            if (ko == 3 || ko == 4) {
                setAttrs({ kob: -1 });
            }
            if (ko == 5) {
                setAttrs({ kob: 0 });
            }
            if (ko == 6 || ko == 7) {
                setAttrs({ kob: 1 });
            }
            if (ko == 8 || ko == 9) {
                setAttrs({ kob: 2 });
            }
            if (ko == 10 || ko == 11) {
                setAttrs({ kob: 3 });
            }
            if (ko == 12 || ko == 13) {
                setAttrs({ kob: 4 });
            }
            if (ko >= 14) {
                setAttrs({ kob: 5 });
            }
        });
    });
    
    on("change:in change:in_bonus", function() {
        getAttrs(["in", "in_bonus"], function(values) {
            let int = parseInt(values.in) + parseInt(values.in_bonus) || 0;
            if (int == 1) {
                setAttrs({ inb: -3 });
            }
            if (int == 2) {
                setAttrs({ inb: -2 });
            }
            if (int == 3 || int == 4) {
                setAttrs({ inb: -1 });
            }
            if (int == 5) {
                setAttrs({ inb: 0 });
            }
            if (int == 6 || int == 7) {
                setAttrs({ inb: 1 });
            }
            if (int == 8 || int == 9) {
                setAttrs({ inb: 2 });
            }
            if (int == 10 || int == 11) {
                setAttrs({ inb: 3 });
            }
            if (int == 12 || int == 13) {
                setAttrs({ inb: 4 });
            }
            if (int >= 14) {
                setAttrs({ inb: 5 });
            }
        });
    });

    on("change:ch change:ch_bonus", function() {
        getAttrs(["ch", "ch_bonus"], function(values) {
            let ch = parseInt(values.ch) + parseInt(values.ch_bonus) || 0;
            if (ch == 1) {
                setAttrs({ chb: -3 });
            }
            if (ch == 2) {
                setAttrs({ chb: -2 });
            }
            if (ch == 3 || ch == 4) {
                setAttrs({ chb: -1 });
            }
            if (ch == 5) {
                setAttrs({ chb: 0 });
            }
            if (ch == 6 || ch == 7) {
                setAttrs({ chb: 1 });
            }
            if (ch == 8 || ch == 9) {
                setAttrs({ chb: 2 });
            }
            if (ch == 10 || ch == 11) {
                setAttrs({ chb: 3 });
            }
            if (ch == 12 || ch == 13) {
                setAttrs({ chb: 4 });
            }
            if (ch >= 14) {
                setAttrs({ chb: 5 });
            }
        });
    });

    on("change:ep", function() {
        getAttrs(["ep"], function(values) {
            let ep = parseInt(values.ep) || 0;
            if (ep < 1000) {
                setAttrs({ stufe: 1 });
            }
            if (ep >= 1000 && ep < 4000) {
                setAttrs({ stufe: 2 });
            }
            if (ep >= 4000 && ep < 8000) {
                setAttrs({ stufe: 3 });
            }
            if (ep >= 8000 && ep < 13000) {
                setAttrs({ stufe: 4 });
            }
            if (ep >= 13000 && ep < 19000) {
                setAttrs({ stufe: 5 });
            }
            if (ep >= 19000 && ep < 26000) {
                setAttrs({ stufe: 6 });
            }
            if (ep >= 26000 && ep < 34000) {
                setAttrs({ stufe: 7 });
            }
            if (ep >= 34000 && ep < 43000) {
                setAttrs({ stufe: 8 });
            }
            if (ep >= 43000 && ep < 53000) {
                setAttrs({ stufe: 9 });
            }
            if (ep >= 53000 && ep < 64000) {
                setAttrs({ stufe: 10 });
            }
            if (ep >= 64000 && ep < 76000) {
                setAttrs({ stufe: 11 });
            }
            if (ep >= 76000 && ep < 89000) {
                setAttrs({ stufe: 12 });
            }
            if (ep >= 89000 && ep < 103000) {
                setAttrs({ stufe: 13 });
            }
            if (ep >= 103000 && ep < 118000) {
                setAttrs({ stufe: 14 });
            }
            if (ep >= 118000 && ep < 134000) {
                setAttrs({ stufe: 15 });
            }
            if (ep >= 134000 && ep < 151000) {
                setAttrs({ stufe: 16 });
            }
            if (ep >= 151000 && ep < 169000) {
                setAttrs({ stufe: 17 });
            }
            if (ep >= 169000 && ep < 188000) {
                setAttrs({ stufe: 18 });
            }
            if (ep >= 188000 && ep < 208000) {
                setAttrs({ stufe: 19 });
            }
            if (ep >= 208000) {
                setAttrs({ stufe: 20 });
            }
        });
    });

    on("change:beruf change:stufe change:kob change:calcleben", function() {
        getAttrs(["kob", "beruf", "stufe", "calcleben"], function(values) {
            let calcleben = parseInt(values.calcleben) || 0;
            let beruf = values.beruf || 0;
            let kob = parseInt(values.kob) || 0;
            let stufe = parseInt(values.stufe) || 0;
            if (beruf == "Zauberer" && calcleben == 1) {
                setAttrs({
                    leben_max: Math.floor((4 + kob) * stufe)
                });
            }
            if (beruf == "Barde" && calcleben == 1 || beruf == "Dieb" && calcleben == 1 || beruf == "Schamane" && calcleben == 1) {
                setAttrs({
                    leben_max: Math.floor((6 + kob) * stufe)
                });
            }
            if (beruf == "Priester" && calcleben == 1 || beruf == "Waldläufer" && calcleben == 1) {
                setAttrs({
                    leben_max: Math.floor((8 + kob) * stufe)
                });
            }
            if (beruf == "Krieger" && calcleben == 1 && calcleben == 1) {
                setAttrs({
                    leben_max: Math.floor((10 + kob) * stufe)
                });
            }
        });
    });

    on("change:beruf change:inb change:chb change:mag change:calcmana", function() {
        getAttrs(["beruf", "inb", "chb", "mag", "calcmana"], function(values) {
            let calcmana = parseInt(values.calcmana) || 0;
            let beruf = values.beruf || 0;
            let inb = parseInt(values.inb) || 0;
            let chb = parseInt(values.chb) || 0;
            let mag = parseInt(values.mag) || 0;
            if (beruf == "Dieb" && calcmana == 1 || beruf == "Krieger" && calcmana == 1 || beruf == "Waldläufer" && calcmana == 1 || beruf == "Zauberer" && calcmana == 1) {
                setAttrs({
                    mana_max: Math.floor((inb + 3) * mag)
                });
            }
            if (beruf == "Barde" && calcmana == 1 || beruf == "Priester" && calcmana == 1 || beruf == "Schamane" && calcmana == 1) {
                setAttrs({
                    mana_max: Math.floor((chb + 3) * mag)
                });
            }
        });
    });

    on("change:mu change:calcmoney", function() {
        getAttrs(["mu", "kl", "calcmoney"], function(values) {
            let calcmoney = parseInt(values.calcmoney) || 0;
            let mu = parseInt(values.mu) || 0;
            let kl = parseInt(values.kl) || 0;
            if (mu >= 10 && calcmoney == 1) {
                setAttrs({
                    mu: mu - 10,
                    kl: kl + 1
                });
            }
            if (mu < 0 && calcmoney == 1) {
                setAttrs({
                    mu: mu + 10,
                    kl: kl - 1
                });
            }
        });
    });
    
    on("change:kl change:calcmoney", function() {
        getAttrs(["kl", "tt", "calcmoney"], function(values) {
            let calcmoney = parseInt(values.calcmoney) || 0;
            let kl = parseInt(values.kl) || 0;
            let tt = parseInt(values.tt) || 0;
            if (kl >= 10 && calcmoney == 1) {
                setAttrs({
                    kl: kl - 10,
                    tt: tt + 1
                });
            }
            if (kl < 0 && calcmoney == 1) {
                setAttrs({
                    kl: kl + 10,
                    tt: tt - 1
                });
            }
        });
    });
    
    on("change:tt change:calcmoney", function() {
        getAttrs(["tt", "gf", "calcmoney"], function(values) {
            let calcmoney = parseInt(values.calcmoney) || 0;
            let tt = parseInt(values.tt) || 0;
            let gf = parseInt(values.gf) || 0;
            if (tt >= 10 && calcmoney == 1) {
                setAttrs({
                    tt: tt - 10,
                    gf: gf + 1
                });
            }
            if (tt < 0 && calcmoney == 1) {
                setAttrs({
                    tt: tt + 10,
                    gf: gf - 1
                });
            }
        });
    });
</script>